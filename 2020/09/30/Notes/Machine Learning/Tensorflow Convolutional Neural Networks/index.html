<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#A288C0"><meta name="author" content="程海盐"><meta name="copyright" content="程海盐"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>Tensorflow 卷积网络 | Ashley</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false},
      {left: "\\(", right: "\\)", display: false},
      {left: "\\[", right: "\\]", display: true}
    ]
  });
});</script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#A288C0"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="Ashley" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"allmainashley.github.io","root":"/","title":"盐姜葱花鱼","version":"1.3.0","mode":"auto","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="前言kears中文文档 * 代表optional，在搭建判断是猫还是狗的卷积神经网络中,不是必备步骤。 Dogs vs. Cats数据集下载地址 PretreatmentUnzip datas1234567import osimport zipfilelocal_zip &#x3D; &amp;#x27;&#x2F;tmp&#x2F;cats_and_dogs_filtered.zip&amp;#x27;zip_ref &#x3D; zipfile.Z">
<meta property="og:type" content="article">
<meta property="og:title" content="Tensorflow 卷积网络">
<meta property="og:url" content="https://allmainashley.github.io/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Convolutional%20Neural%20Networks/index.html">
<meta property="og:site_name" content="Ashley">
<meta property="og:description" content="前言kears中文文档 * 代表optional，在搭建判断是猫还是狗的卷积神经网络中,不是必备步骤。 Dogs vs. Cats数据集下载地址 PretreatmentUnzip datas1234567import osimport zipfilelocal_zip &#x3D; &amp;#x27;&#x2F;tmp&#x2F;cats_and_dogs_filtered.zip&amp;#x27;zip_ref &#x3D; zipfile.Z">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160234.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160235.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160236.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808155700.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150008.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150119.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150120.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200810114345.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200810114437.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809154401.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809154408.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200814091339.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200814091340.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200813122410.png">
<meta property="article:published_time" content="2020-09-29T16:15:53.018Z">
<meta property="article:modified_time" content="2020-09-29T16:15:53.018Z">
<meta property="article:author" content="程海盐">
<meta property="article:tag" content="Tensorflow">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160234.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="程海盐"><img width="96" loading="lazy" src="/images/1.jpg" alt="程海盐"><span class="site-author-status" title="Fall in love with lsh.">💘</span></a><div class="site-author-name"><a href="/about/">程海盐</a></div><a class="site-name" href="/about/site.html">Ashley</a><sub class="site-subtitle">It might be hard,but it's worthy.</sub><div class="site-desciption">喜欢就坚持吧</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">14</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1145777605&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/AllMainAshley" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=136665109" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/378853502" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.yuque.com/allmainashley" title="语雀" target="_blank" style="color:#3CB371"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-yuque"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:ashleyallmain@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dogs-vs-Cats"><span class="toc-number">2.</span> <span class="toc-text">Dogs vs. Cats</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pretreatment"><span class="toc-number">2.1.</span> <span class="toc-text">Pretreatment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unzip-datas"><span class="toc-number">2.1.1.</span> <span class="toc-text">Unzip datas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Define-Directories"><span class="toc-number">2.1.2.</span> <span class="toc-text">Define Directories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Load-into-Python-lists"><span class="toc-number">2.1.3.</span> <span class="toc-text">* Load into Python lists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Print-picture-numbers"><span class="toc-number">2.1.4.</span> <span class="toc-text">* Print picture numbers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Visualization"><span class="toc-number">2.1.5.</span> <span class="toc-text">* Visualization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Build-model"><span class="toc-number">2.1.6.</span> <span class="toc-text">Build model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compile"><span class="toc-number">2.1.7.</span> <span class="toc-text">Compile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-Preprocessing"><span class="toc-number">2.2.</span> <span class="toc-text">Data Preprocessing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-image-generator"><span class="toc-number">2.2.1.</span> <span class="toc-text">Create image generator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Training"><span class="toc-number">2.3.</span> <span class="toc-text">Training</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Running-the-model"><span class="toc-number">2.4.</span> <span class="toc-text">Running the model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Evaluating-Accuracy-and-Loss-for-the-Model"><span class="toc-number">2.5.</span> <span class="toc-text">Evaluating Accuracy and Loss for the Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recap"><span class="toc-number">2.6.</span> <span class="toc-text">Recap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Augmentation"><span class="toc-number">3.</span> <span class="toc-text">Augmentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Transfer-Learning"><span class="toc-number">4.</span> <span class="toc-text">Transfer Learning</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#InceptionV3"><span class="toc-number">4.1.</span> <span class="toc-text">InceptionV3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model"><span class="toc-number">4.2.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageDataGenerator"><span class="toc-number">4.3.</span> <span class="toc-text">ImageDataGenerator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-Fit"><span class="toc-number">4.4.</span> <span class="toc-text">Model Fit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dropout"><span class="toc-number">4.5.</span> <span class="toc-text">Dropout</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Multiclass-Classification"><span class="toc-number">5.</span> <span class="toc-text">Multiclass Classification</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageDataGenerator-1"><span class="toc-number">5.1.</span> <span class="toc-text">ImageDataGenerator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-1"><span class="toc-number">5.2.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compile-1"><span class="toc-number">5.3.</span> <span class="toc-text">Compile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-Fit-1"><span class="toc-number">5.4.</span> <span class="toc-text">Model Fit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Q-amp-A"><span class="toc-number">6.</span> <span class="toc-text">Q&amp;A</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-Exercise1"><span class="toc-number">6.1.</span> <span class="toc-text"> Week2 Exercise1 </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spilt-Data"><span class="toc-number">6.1.1.</span> <span class="toc-text">Spilt Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recap-1"><span class="toc-number">6.1.2.</span> <span class="toc-text">Recap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plot-loss-And-Accuracy"><span class="toc-number">6.1.3.</span> <span class="toc-text"> Plot loss And Accuracy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-Exercise4"><span class="toc-number">6.2.</span> <span class="toc-text">Week2 Exercise4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-Data"><span class="toc-number">6.2.1.</span> <span class="toc-text">Get Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recap-2"><span class="toc-number">6.2.2.</span> <span class="toc-text">Recap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-Dimensional"><span class="toc-number">6.2.3.</span> <span class="toc-text">Add Dimensional</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://allmainashley.github.io/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Convolutional%20Neural%20Networks/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="程海盐"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Ashley"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Tensorflow 卷积网络</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2020-09-30 00:15:53" itemprop="dateCreated datePublished" datetime="2020-09-30T00:15:53+08:00">2020-09-30</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Word count in article">4.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">23m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/Notes/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Notes</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/Notes/Machine-Learning/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Machine Learning</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/Tensorflow/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Tensorflow</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#A288C0;"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a target="_blank" rel="noopener" href="https://keras.io/zh">kears中文文档</a></p>
<p><font color=DarkOrange><code>* 代表optional，在搭建判断是猫还是狗的卷积神经网络中,不是必备步骤。</code></font></p>
<h1 id="Dogs-vs-Cats"><a href="#Dogs-vs-Cats" class="headerlink" title="Dogs vs. Cats"></a>Dogs vs. Cats</h1><p><a target="_blank" rel="noopener" href="https://storage.googleapis.com/mledu-datasets/cats_and_dogs_filtered.zip">数据集下载地址</a></p>
<h2 id="Pretreatment"><a href="#Pretreatment" class="headerlink" title="Pretreatment"></a>Pretreatment</h2><h3 id="Unzip-datas"><a href="#Unzip-datas" class="headerlink" title="Unzip datas"></a><font color=Salmon>Unzip datas</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">local_zip = <span class="string">&#x27;/tmp/cats_and_dogs_filtered.zip&#x27;</span></span><br><span class="line">zip_ref = zipfile.ZipFile(local_zip, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">zip_ref.extractall(<span class="string">&#x27;/tmp&#x27;</span>)</span><br><span class="line">zip_ref.close()</span><br></pre></td></tr></table></figure>



<h3 id="Define-Directories"><a href="#Define-Directories" class="headerlink" title="Define Directories"></a><font color=Salmon>Define Directories</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">base_dir = <span class="string">&#x27;/tmp/cats_and_dogs_filtered&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接路径</span></span><br><span class="line">train_dir = os.path.join(base_dir, <span class="string">&#x27;train&#x27;</span>) </span><br><span class="line">validation_dir = os.path.join(base_dir, <span class="string">&#x27;validation&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory with our training cat/dog pictures</span></span><br><span class="line">train_cats_dir = os.path.join(train_dir, <span class="string">&#x27;cats&#x27;</span>)</span><br><span class="line">train_dogs_dir = os.path.join(train_dir, <span class="string">&#x27;dogs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory with our validation cat/dog pictures</span></span><br><span class="line">validation_cats_dir = os.path.join(validation_dir, <span class="string">&#x27;cats&#x27;</span>)</span><br><span class="line">validation_dogs_dir = os.path.join(validation_dir, <span class="string">&#x27;dogs&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="Load-into-Python-lists"><a href="#Load-into-Python-lists" class="headerlink" title="* Load into Python lists"></a><font color=Salmon>* Load into Python lists</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">train_cat_fnames = os.listdir( train_cats_dir ) <span class="comment">#os.listdir() 方法用于返回指定的文件夹包含的文件或文件夹的名字的列表</span></span><br><span class="line">train_dog_fnames = os.listdir( train_dogs_dir )</span><br><span class="line"></span><br><span class="line">print(train_cat_fnames[:<span class="number">10</span>])</span><br><span class="line">print(train_dog_fnames[:<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">打印结果：</span></span><br><span class="line"><span class="string">[&#x27;cat.277.jpg&#x27;, &#x27;cat.424.jpg&#x27;, &#x27;cat.809.jpg&#x27;, &#x27;cat.148.jpg&#x27;, &#x27;cat.114.jpg&#x27;, &#x27;cat.264.jpg&#x27;, &#x27;cat.392.jpg&#x27;, &#x27;cat.355.jpg&#x27;, &#x27;cat.671.jpg&#x27;, &#x27;cat.562.jpg&#x27;]</span></span><br><span class="line"><span class="string">[&#x27;dog.928.jpg&#x27;, &#x27;dog.88.jpg&#x27;, &#x27;dog.470.jpg&#x27;, &#x27;dog.782.jpg&#x27;, &#x27;dog.346.jpg&#x27;, &#x27;dog.383.jpg&#x27;, &#x27;dog.728.jpg&#x27;, &#x27;dog.979.jpg&#x27;, &#x27;dog.389.jpg&#x27;, &#x27;dog.71.jpg&#x27;]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="Print-picture-numbers"><a href="#Print-picture-numbers" class="headerlink" title="* Print picture numbers"></a><font color=Salmon>* Print picture numbers</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;total training cat images :&#x27;</span>, len(os.listdir(      train_cats_dir ) ))</span><br><span class="line">print(<span class="string">&#x27;total training dog images :&#x27;</span>, len(os.listdir(      train_dogs_dir ) ))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;total validation cat images :&#x27;</span>, len(os.listdir( validation_cats_dir ) ))</span><br><span class="line">print(<span class="string">&#x27;total validation dog images :&#x27;</span>, len(os.listdir( validation_dogs_dir ) ))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">打印结果：</span></span><br><span class="line"><span class="string">total training cat images : 1000</span></span><br><span class="line"><span class="string">total training dog images : 1000</span></span><br><span class="line"><span class="string">total validation cat images : 500</span></span><br><span class="line"><span class="string">total validation dog images : 500</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="Visualization"><a href="#Visualization" class="headerlink" title="* Visualization"></a><font color=Salmon>* Visualization</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.image <span class="keyword">as</span> mpimg</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameters for our graph; we&#x27;ll output images in a 4x4 configuration</span></span><br><span class="line">nrows = <span class="number">4</span></span><br><span class="line">ncols = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">pic_index = <span class="number">0</span> <span class="comment"># Index for iterating over images</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up matplotlib fig, and size it to fit 4x4 pics</span></span><br><span class="line">fig = plt.gcf()		 <span class="comment"># Get Current Figure</span></span><br><span class="line">fig.set_size_inches(ncols*<span class="number">4</span>, nrows*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">pic_index+=<span class="number">8</span></span><br><span class="line"></span><br><span class="line">next_cat_pix = [os.path.join(train_cats_dir, fname) </span><br><span class="line">                <span class="keyword">for</span> fname <span class="keyword">in</span> train_cat_fnames[ pic_index<span class="number">-8</span>:pic_index] </span><br><span class="line">               ]</span><br><span class="line"></span><br><span class="line">next_dog_pix = [os.path.join(train_dogs_dir, fname) </span><br><span class="line">                <span class="keyword">for</span> fname <span class="keyword">in</span> train_dog_fnames[ pic_index<span class="number">-8</span>:pic_index]</span><br><span class="line">               ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, img_path <span class="keyword">in</span> enumerate(next_cat_pix+next_dog_pix):</span><br><span class="line">  <span class="comment"># Set up subplot; subplot indices start at 1</span></span><br><span class="line">  sp = plt.subplot(nrows, ncols, i + <span class="number">1</span>)</span><br><span class="line">  sp.axis(<span class="string">&#x27;Off&#x27;</span>) <span class="comment"># Don&#x27;t show axes (or gridlines)</span></span><br><span class="line"></span><br><span class="line">  img = mpimg.imread(img_path)</span><br><span class="line">  plt.imshow(img)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<h3 id="Build-model"><a href="#Build-model" class="headerlink" title="Build model"></a><font color=Salmon>Build model</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    <span class="comment"># Note the input shape is the desired size of the image 150x150 with 3 bytes color</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">16</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>)),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>), </span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>), </span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    <span class="comment"># Flatten the results to feed into a DNN</span></span><br><span class="line">    tf.keras.layers.Flatten(), </span><br><span class="line">    <span class="comment"># 512 neuron hidden layer</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>), </span><br><span class="line">    <span class="comment"># Only 1 output neuron. It will contain a value from 0-1 where 0 for 1 class (&#x27;cats&#x27;) and 1 for the other (&#x27;dogs&#x27;)</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)  </span><br><span class="line">]</span><br><span class="line">    </span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>

<p>打印模型概述信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Model: &quot;sequential_2&quot;</span><br><span class="line">_________________________________________________________________</span><br><span class="line">Layer (type)                 Output Shape              Param #   </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">conv2d_6 (Conv2D)            (None, 148, 148, 16)      448       </span><br><span class="line">_________________________________________________________________</span><br><span class="line">max_pooling2d_6 (MaxPooling2 (None, 74, 74, 16)        0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">conv2d_7 (Conv2D)            (None, 72, 72, 32)        4640      </span><br><span class="line">_________________________________________________________________</span><br><span class="line">max_pooling2d_7 (MaxPooling2 (None, 36, 36, 32)        0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">conv2d_8 (Conv2D)            (None, 34, 34, 64)        18496     </span><br><span class="line">_________________________________________________________________</span><br><span class="line">max_pooling2d_8 (MaxPooling2 (None, 17, 17, 64)        0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">flatten_2 (Flatten)          (None, 18496)             0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dense_4 (Dense)              (None, 512)               9470464   </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dense_5 (Dense)              (None, 1)                 513       </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Total params: 9,494,561</span><br><span class="line">Trainable params: 9,494,561</span><br><span class="line">Non-trainable params: 0</span><br><span class="line">_________________________________________________________________</span><br></pre></td></tr></table></figure>



<h3 id="Compile"><a href="#Compile" class="headerlink" title="Compile"></a><font color=Salmon>Compile</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model.compile(optimizer=RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics = [<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>





<h2 id="Data-Preprocessing"><a href="#Data-Preprocessing" class="headerlink" title="Data Preprocessing"></a>Data Preprocessing</h2><h3 id="Create-image-generator"><a href="#Create-image-generator" class="headerlink" title="Create image generator"></a><font color=Salmon>Create image generator</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line"><span class="comment"># All images will be rescaled by 1./255.</span></span><br><span class="line">train_datagen = ImageDataGenerator( rescale = <span class="number">1.0</span>/<span class="number">255.</span> )</span><br><span class="line">test_datagen  = ImageDataGenerator( rescale = <span class="number">1.0</span>/<span class="number">255.</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line"><span class="comment"># Flow training images in batches of 20 using train_datagen generator</span></span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line">train_generator = train_datagen.flow_from_directory(train_dir,</span><br><span class="line">                                                    batch_size=<span class="number">20</span>,</span><br><span class="line">                                                    class_mode=<span class="string">&#x27;binary&#x27;</span>,</span><br><span class="line">                                                    target_size=(<span class="number">150</span>, <span class="number">150</span>))     </span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line"><span class="comment"># Flow validation images in batches of 20 using test_datagen generator</span></span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line">validation_generator =  test_datagen.flow_from_directory(validation_dir,</span><br><span class="line">                                                         batch_size=<span class="number">20</span>,</span><br><span class="line">                                                         class_mode  = <span class="string">&#x27;binary&#x27;</span>,</span><br><span class="line">                                                         target_size = (<span class="number">150</span>, <span class="number">150</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(train_generator,</span><br><span class="line">                    validation_data=validation_generator,</span><br><span class="line">                    steps_per_epoch=<span class="number">100</span>,</span><br><span class="line">                    epochs=<span class="number">15</span>,</span><br><span class="line">                    validation_steps=<span class="number">50</span>,</span><br><span class="line">                    verbose=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Epoch 1&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0300 - accuracy: 0.9925 - val_loss: 1.9040 - val_accuracy: 0.7120</span><br><span class="line">Epoch 2&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0350 - accuracy: 0.9890 - val_loss: 1.7071 - val_accuracy: 0.7210</span><br><span class="line">Epoch 3&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0188 - accuracy: 0.9925 - val_loss: 2.0725 - val_accuracy: 0.6950</span><br><span class="line">Epoch 4&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0291 - accuracy: 0.9915 - val_loss: 2.3252 - val_accuracy: 0.7080</span><br><span class="line">Epoch 5&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0303 - accuracy: 0.9940 - val_loss: 2.1299 - val_accuracy: 0.7340</span><br><span class="line">Epoch 6&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0193 - accuracy: 0.9930 - val_loss: 2.0416 - val_accuracy: 0.7400</span><br><span class="line">Epoch 7&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0197 - accuracy: 0.9925 - val_loss: 2.1636 - val_accuracy: 0.7300</span><br><span class="line">Epoch 8&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0251 - accuracy: 0.9925 - val_loss: 2.4540 - val_accuracy: 0.7360</span><br><span class="line">Epoch 9&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0180 - accuracy: 0.9955 - val_loss: 2.7262 - val_accuracy: 0.7260</span><br><span class="line">Epoch 10&#x2F;15</span><br><span class="line">100&#x2F;100 - 60s - loss: 0.0163 - accuracy: 0.9960 - val_loss: 2.8085 - val_accuracy: 0.7040</span><br><span class="line">Epoch 11&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0400 - accuracy: 0.9905 - val_loss: 2.6529 - val_accuracy: 0.7270</span><br><span class="line">Epoch 12&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0193 - accuracy: 0.9945 - val_loss: 2.8958 - val_accuracy: 0.7220</span><br><span class="line">Epoch 13&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0204 - accuracy: 0.9950 - val_loss: 3.2313 - val_accuracy: 0.7250</span><br><span class="line">Epoch 14&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 9.9441e-05 - accuracy: 1.0000 - val_loss: 3.5450 - val_accuracy: 0.7270</span><br><span class="line">Epoch 15&#x2F;15</span><br><span class="line">100&#x2F;100 - 55s - loss: 0.0781 - accuracy: 0.9905 - val_loss: 3.2831 - val_accuracy: 0.6940</span><br></pre></td></tr></table></figure>

<h2 id="Running-the-model"><a href="#Running-the-model" class="headerlink" title="Running the model"></a>Running the model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> files</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"></span><br><span class="line">uploaded=files.upload()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> uploaded.keys():</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># predicting images</span></span><br><span class="line">  path=<span class="string">&#x27;/content/&#x27;</span> + fn</span><br><span class="line">  img=image.load_img(path, target_size=(<span class="number">150</span>, <span class="number">150</span>))</span><br><span class="line">  </span><br><span class="line">  x=image.img_to_array(img)</span><br><span class="line">  x=np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line">  images = np.vstack([x])</span><br><span class="line">  </span><br><span class="line">  classes = model.predict(images, batch_size=<span class="number">10</span>)</span><br><span class="line">  </span><br><span class="line">  print(classes[<span class="number">0</span>])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> classes[<span class="number">0</span>]&gt;<span class="number">0</span>:</span><br><span class="line">    print(fn + <span class="string">&quot; is a dog&quot;</span>)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    print(fn + <span class="string">&quot; is a cat&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>通过裁剪图片，可以改变分类的结果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160234.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160235.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808160236.png" loading="lazy"></p>
<h2 id="Evaluating-Accuracy-and-Loss-for-the-Model"><a href="#Evaluating-Accuracy-and-Loss-for-the-Model" class="headerlink" title="Evaluating Accuracy and Loss for the Model"></a>Evaluating Accuracy and Loss for the Model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Retrieve a list of list results on training and test data</span></span><br><span class="line"><span class="comment"># sets for each training epoch</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------</span></span><br><span class="line">acc      = history.history[     <span class="string">&#x27;accuracy&#x27;</span> ]</span><br><span class="line">val_acc  = history.history[ <span class="string">&#x27;val_accuracy&#x27;</span> ]</span><br><span class="line">loss     = history.history[    <span class="string">&#x27;loss&#x27;</span> ]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span> ]</span><br><span class="line"></span><br><span class="line">epochs   = range(len(acc)) <span class="comment"># Get number of epochs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation accuracy per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot  ( epochs,     acc )</span><br><span class="line">plt.plot  ( epochs, val_acc )</span><br><span class="line">plt.title (<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation loss per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot  ( epochs,     loss )</span><br><span class="line">plt.plot  ( epochs, val_loss )</span><br><span class="line">plt.title (<span class="string">&#x27;Training and validation loss&#x27;</span>   )</span><br></pre></td></tr></table></figure>

<p><font color=SteelBlue>Training</font>  and <font color=DarkOrange>Validation</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200808155700.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150008.png" loading="lazy"></p>
<h2 id="Recap"><a href="#Recap" class="headerlink" title="Recap"></a>Recap</h2><p><font color=Green>**How to build a Dogs vs. Cats classifier? **</font></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Unzip datas. 解压数据</li>
<li><input checked="" disabled="" type="checkbox"> Define Directories. 指定文件夹 </li>
<li><input checked="" disabled="" type="checkbox"> Build the model. 搭建模型 （model.Sequential)</li>
<li><input checked="" disabled="" type="checkbox"> Compile the model. 编译模型</li>
<li><input checked="" disabled="" type="checkbox"> Create image generator. 创建图像生成器（标准化数据、flow_from_directory读文件）</li>
<li><input checked="" disabled="" type="checkbox"> Train the model. 训练模型（注意：是model.fit_generator)</li>
<li><input checked="" disabled="" type="checkbox"> Running the model. （测试新图片）</li>
<li><input checked="" disabled="" type="checkbox"> Evaluating Accuracy and Loss for the Model. （评估准确性和损失）</li>
</ul>
<h1 id="Augmentation"><a href="#Augmentation" class="headerlink" title="Augmentation"></a>Augmentation</h1><p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150119.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809150120.png" loading="lazy"></p>
<p>如图：在20个epoches后，训练集的准确性接近1，而验证集的准确性并没有提升，说明此时已经出现了过拟合。</p>
<p><a target="_blank" rel="noopener" href="https://keras.io/zh/preprocessing/image/">ImageDataGenerator 详情</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line">train_datagen = ImageDataGenerator(</span><br><span class="line">    rescale=(<span class="number">1.</span>/<span class="number">255</span>),</span><br><span class="line">    rotation_range=<span class="number">40</span>,  </span><br><span class="line">    width_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    height_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    shear_range=<span class="number">0.2</span>,</span><br><span class="line">    zoom_range=<span class="number">0.2</span>,</span><br><span class="line">    horizontal_flip=<span class="literal">True</span>,</span><br><span class="line">    fill_mode=<span class="string">&#x27;nearest&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><p><strong>rescale</strong>: 重缩放因子。默认为 None。如果是 None 或 0，不进行缩放，否则将数据乘以所提供的值（在应用任何其他转换之前）。</p>
</li>
<li><p><strong>rotation_range</strong>: 整数。随机旋转的度数范围。</p>
</li>
<li><p><strong>width_shift_range</strong>: 浮点数、一维数组或整数</p>
<ul>
<li>float: 如果 &lt;1，则是除以总宽度的值，或者如果 &gt;=1，则为像素值。</li>
<li>1-D 数组: 数组中的随机元素。</li>
<li>int: 来自间隔 <code>(-width_shift_range, +width_shift_range)</code> 之间的整数个像素。</li>
<li><code>width_shift_range=2</code> 时，可能值是整数 <code>[-1, 0, +1]</code>，与 <code>width_shift_range=[-1, 0, +1]</code> 相同；而 <code>width_shift_range=1.0</code> 时，可能值是 <code>[-1.0, +1.0)</code> 之间的浮点数。</li>
</ul>
</li>
<li><p><strong>height_shift_range</strong>: 浮点数、一维数组或整数</p>
<ul>
<li>float: 如果 &lt;1，则是除以总宽度的值，或者如果 &gt;=1，则为像素值。</li>
<li>1-D array-like: 数组中的随机元素。</li>
<li>int: 来自间隔 <code>(-height_shift_range, +height_shift_range)</code> 之间的整数个像素。</li>
<li><code>height_shift_range=2</code> 时，可能值是整数 <code>[-1, 0, +1]</code>，与 <code>height_shift_range=[-1, 0, +1]</code> 相同；而 <code>height_shift_range=1.0</code> 时，可能值是 <code>[-1.0, +1.0)</code> 之间的浮点数。</li>
</ul>
</li>
<li><p><strong>shear_range</strong>: 浮点数。剪切强度（以弧度逆时针方向剪切角度）。</p>
</li>
<li><p><strong>zoom_range</strong>: 浮点数 或 <code>[lower, upper]</code>。随机缩放范围。如果是浮点数，<code>[lower, upper] = [1-zoom_range, 1+zoom_range]</code>。</p>
</li>
<li><p><strong>horizontal_flip</strong>: 布尔值。随机水平翻转。 </p>
</li>
<li><p><strong>fill_mode</strong>: {“constant”, “nearest”, “reflect” or “wrap”} 之一。默认为 ‘nearest’。输入边界以外的点根据给定的模式填充：</p>
<ul>
<li><p>‘constant’: kkkkkkkk|abcd|kkkkkkkk (cval=k)</p>
</li>
<li><p>‘nearest’: aaaaaaaa|abcd|dddddddd</p>
</li>
<li><p>‘reflect’: abcddcba|abcd|dcbaabcd</p>
</li>
<li><p>‘wrap’: abcdabcd|abcd|abcdabcd</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>修改了ImageDataGenerator后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200810114345.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200810114437.png" loading="lazy"></p>
<p>可以看出，如果只对训练集的ImageDataGenerator做出修改，会使得验证集波动过大，所以要对训练集和验证集的ImageDataGenerator做出同样的修改。</p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809154401.png" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200809154408.png" loading="lazy"></p>
<h1 id="Transfer-Learning"><a href="#Transfer-Learning" class="headerlink" title="Transfer Learning"></a>Transfer Learning</h1><blockquote>
<p>准备资料：</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1512.00567">Rethinking the Inception Architecture for Computer Vision</a></p>
<p><a target="_blank" rel="noopener" href="http://image-net.org/">Image datasets</a></p>
</blockquote>
<h2 id="InceptionV3"><a href="#InceptionV3" class="headerlink" title="InceptionV3"></a><font color=DarkOrange>InceptionV3</font></h2><p><a target="_blank" rel="noopener" href="https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5">下载地址</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.applications.inception_v3 <span class="keyword">import</span> InceptionV3</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line">local_weights_file = <span class="string">&#x27;inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 预训练模型</span></span><br><span class="line">pre_trained_model = InceptionV3(input_shape = (<span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>), </span><br><span class="line">                                include_top = <span class="literal">False</span>, </span><br><span class="line">                                weights = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 读取网络权值</span></span><br><span class="line">pre_trained_model.load_weights(local_weights_file)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 冻结层</span></span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> pre_trained_model.layers:</span><br><span class="line">  layer.trainable = <span class="literal">False</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># pre_trained_model.summary()	# 因为概述信息太长，故将这一行注释掉</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 看一下最后一层形状</span></span><br><span class="line">last_layer = pre_trained_model.get_layer(<span class="string">&#x27;mixed7&#x27;</span>)		<span class="comment"># 获得InceptionV3网络mixed7卷积层</span></span><br><span class="line">print(<span class="string">&#x27;last layer output shape: &#x27;</span>, last_layer.output_shape)</span><br><span class="line">last_output = last_layer.output</span><br></pre></td></tr></table></figure>

<p>打印信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last layer output shape:  (None, 7, 7, 768)</span><br></pre></td></tr></table></figure>

<p>补充：</p>
<ul>
<li><p><code>include_top</code>：布尔值，是否将最上层的完全连接层作为网络的最后一层。默认为<code>True</code>。</p>
<p><code>weights</code>：（<code>None</code>随机初始化）， <code>imagenet</code>（在ImageNet上进行预训练）或要加载的weights文件的路径之一。默认为<code>imagenet</code>。</p>
</li>
<li><p><code>keras.models.load_model()</code>:  读取网络、权重<br><code>keras.models.load_weights()</code> : 仅读取权重</p>
</li>
<li><p>设置<code>layer.trainable</code>为<code>False</code>将所有图层的权重从可训练变为不可训练。这称为“冻结”层：<font color=Rainbow>冻结层的状态在训练期间不会更新</font>（使用训练<code>fit()</code>或使用依赖于<code>trainable_weights</code>应用渐变更新的任何自定义循环进行训练时）。<a target="_blank" rel="noopener" href="https://keras.io/guides/transfer_learning/">详情</a></p>
</li>
</ul>
<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a><font color=DarkOrange>Model</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flatten the output layer to 1 dimension</span></span><br><span class="line">x = layers.Flatten()(last_output)</span><br><span class="line"><span class="comment"># Add a fully connected layer with 1,024 hidden units and ReLU activation</span></span><br><span class="line">x = layers.Dense(<span class="number">1024</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)                </span><br><span class="line"><span class="comment"># Add a final sigmoid layer for classification</span></span><br><span class="line">x = layers.Dense  (<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)           </span><br><span class="line"></span><br><span class="line">model = Model( pre_trained_model.input, x) </span><br><span class="line"></span><br><span class="line">model.compile(optimizer = RMSprop(lr=<span class="number">0.0001</span>), </span><br><span class="line">              loss = <span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics = [<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>



<h2 id="ImageDataGenerator"><a href="#ImageDataGenerator" class="headerlink" title="ImageDataGenerator"></a><font color=DarkOrange>ImageDataGenerator</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">local_zip = <span class="string">&#x27;cats_and_dogs_filtered.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">zip_ref = zipfile.ZipFile(local_zip, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line">zip_ref.extractall()</span><br><span class="line">zip_ref.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define our example directories and files</span></span><br><span class="line">base_dir = <span class="string">&#x27;cats_and_dogs_filtered&#x27;</span></span><br><span class="line"></span><br><span class="line">train_dir = os.path.join( base_dir, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">validation_dir = os.path.join( base_dir, <span class="string">&#x27;validation&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train_cats_dir = os.path.join(train_dir, <span class="string">&#x27;cats&#x27;</span>) <span class="comment"># Directory with our training cat pictures</span></span><br><span class="line">train_dogs_dir = os.path.join(train_dir, <span class="string">&#x27;dogs&#x27;</span>) <span class="comment"># Directory with our training dog pictures</span></span><br><span class="line">validation_cats_dir = os.path.join(validation_dir, <span class="string">&#x27;cats&#x27;</span>) <span class="comment"># Directory with our validation cat pictures</span></span><br><span class="line">validation_dogs_dir = os.path.join(validation_dir, <span class="string">&#x27;dogs&#x27;</span>)<span class="comment"># Directory with our validation dog pictures</span></span><br><span class="line"></span><br><span class="line">train_cat_fnames = os.listdir(train_cats_dir)</span><br><span class="line">train_dog_fnames = os.listdir(train_dogs_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add our data-augmentation parameters to ImageDataGenerator</span></span><br><span class="line">train_datagen = ImageDataGenerator(rescale = <span class="number">1.</span>/<span class="number">255.</span>,</span><br><span class="line">                                   rotation_range = <span class="number">40</span>,</span><br><span class="line">                                   width_shift_range = <span class="number">0.2</span>,</span><br><span class="line">                                   height_shift_range = <span class="number">0.2</span>,</span><br><span class="line">                                   shear_range = <span class="number">0.2</span>,</span><br><span class="line">                                   zoom_range = <span class="number">0.2</span>,</span><br><span class="line">                                   horizontal_flip = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that the validation data should not be augmented!</span></span><br><span class="line">test_datagen = ImageDataGenerator( rescale = <span class="number">1.0</span>/<span class="number">255.</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flow training images in batches of 20 using train_datagen generator</span></span><br><span class="line">train_generator = train_datagen.flow_from_directory(train_dir,</span><br><span class="line">                                                    batch_size = <span class="number">20</span>,</span><br><span class="line">                                                    class_mode = <span class="string">&#x27;binary&#x27;</span>, </span><br><span class="line">                                                    target_size = (<span class="number">150</span>, <span class="number">150</span>))     </span><br><span class="line"></span><br><span class="line"><span class="comment"># Flow validation images in batches of 20 using test_datagen generator</span></span><br><span class="line">validation_generator =  test_datagen.flow_from_directory( validation_dir,</span><br><span class="line">                                                          batch_size  = <span class="number">20</span>,</span><br><span class="line">                                                          class_mode  = <span class="string">&#x27;binary&#x27;</span>, </span><br><span class="line">                                                          target_size = (<span class="number">150</span>, <span class="number">150</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Model-Fit"><a href="#Model-Fit" class="headerlink" title="Model Fit"></a><font color=DarkOrange>Model Fit</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(</span><br><span class="line">            train_generator,</span><br><span class="line">            validation_data = validation_generator,</span><br><span class="line">            steps_per_epoch = <span class="number">100</span>,</span><br><span class="line">            epochs = <span class="number">20</span>,</span><br><span class="line">            validation_steps = <span class="number">50</span>,</span><br><span class="line">            verbose = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>Keras <code>Model</code> 上的 <code>fit()</code> 方法返回一个 <code>History</code> 对象。<code>History.history</code> 属性是一个记录了连续迭代的训练/验证（如果存在）损失值和评估值的字典。</li>
<li><code>plt.legend(loc=&#39;位置&#39;) </code>: 0表示<code>&#39;best&#39;</code>。 <a target="_blank" rel="noopener" href="https://mofanpy.com/tutorials/data-manipulation/plt/legend/">详情</a></li>
<li><code>plt.figure</code>: 定义一个图像窗口。 <a target="_blank" rel="noopener" href="https://mofanpy.com/tutorials/data-manipulation/plt/figure/">详情</a></li>
</ul>
<p>可以看出验证集的准确率飘忽不定，这是因为模型过拟合了。接下来我们使用<strong>Dropout</strong> (随机失活) 来减少过拟合</p>
<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200814091339.png" loading="lazy"></p>
<h2 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a><font color=DarkOrange>Dropout</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flatten the output layer to 1 dimension</span></span><br><span class="line">x = layers.Flatten()(last_output)</span><br><span class="line"><span class="comment"># Add a fully connected layer with 1,024 hidden units and ReLU activation</span></span><br><span class="line">x = layers.Dense(<span class="number">1024</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"><span class="comment"># Add a dropout rate of 0.2</span></span><br><span class="line">x = layers.Dropout(<span class="number">0.2</span>)(x)                  </span><br><span class="line"><span class="comment"># Add a final sigmoid layer for classification</span></span><br><span class="line">x = layers.Dense  (<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)           </span><br><span class="line"></span><br><span class="line">model = Model( pre_trained_model.input, x) </span><br><span class="line"></span><br><span class="line">model.compile(optimizer = RMSprop(lr=<span class="number">0.0001</span>), </span><br><span class="line">              loss = <span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics = [<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200814091340.png" loading="lazy"></p>
<h1 id="Multiclass-Classification"><a href="#Multiclass-Classification" class="headerlink" title="Multiclass Classification"></a>Multiclass Classification</h1><p><a target="_blank" rel="noopener" href="http://www.laurencemoroney.com/rock-paper-scissors-dataset/">Rock Paper Scissors</a></p>
<h2 id="ImageDataGenerator-1"><a href="#ImageDataGenerator-1" class="headerlink" title="ImageDataGenerator"></a><font color=MediumAquaMarine>ImageDataGenerator</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">train_datagen= ImageDataGenerator(</span><br><span class="line">      rescale = <span class="number">1.</span>/<span class="number">255</span>,</span><br><span class="line">	  rotation_range=<span class="number">40</span>,</span><br><span class="line">      width_shift_range=<span class="number">0.2</span>,</span><br><span class="line">      height_shift_range=<span class="number">0.2</span>,</span><br><span class="line">      shear_range=<span class="number">0.2</span>,</span><br><span class="line">      zoom_range=<span class="number">0.2</span>,</span><br><span class="line">      horizontal_flip=<span class="literal">True</span>,</span><br><span class="line">      fill_mode=<span class="string">&#x27;nearest&#x27;</span>	</span><br><span class="line">)</span><br><span class="line">test_datagen=ImageDataGenerator(</span><br><span class="line">	  rescale = <span class="number">1.</span>/<span class="number">255</span>,</span><br><span class="line">	  rotation_range=<span class="number">40</span>,</span><br><span class="line">      width_shift_range=<span class="number">0.2</span>,</span><br><span class="line">      height_shift_range=<span class="number">0.2</span>,</span><br><span class="line">      shear_range=<span class="number">0.2</span>,</span><br><span class="line">      zoom_range=<span class="number">0.2</span>,</span><br><span class="line">      horizontal_flip=<span class="literal">True</span>,</span><br><span class="line">      fill_mode=<span class="string">&#x27;nearest&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">train_generator=train_datagen.flow_from_directory(</span><br><span class="line">    train_dir,</span><br><span class="line">    target_size=(<span class="number">300</span>,<span class="number">300</span>),</span><br><span class="line">    batch_size=<span class="number">126</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;categorical&#x27;</span>    <span class="comment"># 这不再是二分类所以，class_mode要更改为categorical</span></span><br><span class="line">)</span><br><span class="line">validation_generator=test_datagen.flow_from_directory(</span><br><span class="line">    train_dir,</span><br><span class="line">    target_size=(<span class="number">300</span>, <span class="number">300</span>),</span><br><span class="line">    batch_size=<span class="number">126</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;categorical&#x27;</span>  <span class="comment"># 这不再是二分类所以，class_mode要更改为categorical</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="Model-1"><a href="#Model-1" class="headerlink" title="Model"></a><font color=MediumAquaMarine>Model</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model=tf.keras.Sequential(</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">16</span>,(<span class="number">3</span>,<span class="number">3</span>),activation=<span class="string">&#x27;relu&#x27;</span>,input_shape=(<span class="number">300</span>,<span class="number">300</span>,<span class="number">3</span>)),</span><br><span class="line">    tf.keras.layers.MaxPool2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.MaxPool2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.MaxPool2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">512</span>,activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">3</span>,activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="Compile-1"><a href="#Compile-1" class="headerlink" title="Compile"></a><font color=MediumAquaMarine>Compile</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.compile(loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,	<span class="comment">#这里也要修改为 categorical_crossentropy</span></span><br><span class="line">              optimizer=RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure>



<h2 id="Model-Fit-1"><a href="#Model-Fit-1" class="headerlink" title="Model Fit"></a><font color=MediumAquaMarine>Model Fit</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(</span><br><span class="line">    train_generator, </span><br><span class="line">    epochs=<span class="number">25</span>, </span><br><span class="line">    steps_per_epoch=<span class="number">20</span>, </span><br><span class="line">    validation_data = validation_generator,</span><br><span class="line">    verbose = <span class="number">1</span>, </span><br><span class="line">    validation_steps=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/AllMainAshley/CDN/images/20200813122410.png" loading="lazy"></p>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="Week2-Exercise1"><a href="#Week2-Exercise1" class="headerlink" title=" Week2 Exercise1 "></a> Week2 Exercise1 </h2><h3 id="Spilt-Data"><a href="#Spilt-Data" class="headerlink" title="Spilt Data"></a><font color=LightSalmon>Spilt Data</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_data</span>(<span class="params">SOURCE, TRAINING, TESTING, SPLIT_SIZE</span>):</span></span><br><span class="line"><span class="comment"># YOUR CODE STARTS HERE</span></span><br><span class="line">    dataset = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> unitData <span class="keyword">in</span> os.listdir(SOURCE):</span><br><span class="line">        data = SOURCE + unitData	<span class="comment"># data指的是每个文件的路径</span></span><br><span class="line">        <span class="keyword">if</span> (os.path.getsize(data) &gt; <span class="number">0</span>):	</span><br><span class="line">            dataset.append(unitData)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;Skipped &#x27;</span> + unitData)</span><br><span class="line">            print(<span class="string">&#x27;Invalid file size! i.e Zero length.&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    train_data_length = int(len(dataset) * SPLIT_SIZE)			<span class="comment"># 训练集占的图片数量</span></span><br><span class="line">    test_data_length = int(len(dataset) - train_data_length)	<span class="comment"># 测试集占的图片数量</span></span><br><span class="line">    shuffled_set = random.sample(dataset, len(dataset))</span><br><span class="line">    train_set = shuffled_set[<span class="number">0</span>:train_data_length]</span><br><span class="line">    test_set = shuffled_set[-test_data_length:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> unitData <span class="keyword">in</span> train_set:</span><br><span class="line">        temp_train_data = SOURCE + unitData</span><br><span class="line">        final_train_data = TRAINING + unitData</span><br><span class="line">        copyfile(temp_train_data, final_train_data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> unitData <span class="keyword">in</span> test_set:</span><br><span class="line">        temp_test_data = SOURCE + unitData</span><br><span class="line">        final_test_data = TESTING + unitData</span><br><span class="line">        copyfile(temp_train_data, final_test_data)</span><br><span class="line"><span class="comment"># YOUR CODE ENDS HERE</span></span><br><span class="line"></span><br><span class="line">CAT_SOURCE_DIR = <span class="string">&quot;/tmp/PetImages/Cat/&quot;</span></span><br><span class="line">TRAINING_CATS_DIR = <span class="string">&quot;/tmp/cats-v-dogs/training/cats/&quot;</span></span><br><span class="line">TESTING_CATS_DIR = <span class="string">&quot;/tmp/cats-v-dogs/testing/cats/&quot;</span></span><br><span class="line">DOG_SOURCE_DIR = <span class="string">&quot;/tmp/PetImages/Dog/&quot;</span></span><br><span class="line">TRAINING_DOGS_DIR = <span class="string">&quot;/tmp/cats-v-dogs/training/dogs/&quot;</span></span><br><span class="line">TESTING_DOGS_DIR = <span class="string">&quot;/tmp/cats-v-dogs/testing/dogs/&quot;</span></span><br><span class="line"></span><br><span class="line">split_size = <span class="number">.9</span></span><br><span class="line">split_data(CAT_SOURCE_DIR, TRAINING_CATS_DIR, TESTING_CATS_DIR, split_size)</span><br><span class="line">split_data(DOG_SOURCE_DIR, TRAINING_DOGS_DIR, TESTING_DOGS_DIR, split_size)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>输出所有文件和文件夹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> dirs = os.listdir( path ):</span><br><span class="line">	<span class="keyword">print</span> file</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回文件大小，如果文件不存在就返回错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.getsize(path)</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了提取出N个不同元素的样本用来做进一步的操作，可以使用 <code>random.sample()</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample(values, <span class="number">2</span>)</span><br><span class="line">[<span class="number">6</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample(values, <span class="number">2</span>)</span><br><span class="line">[<span class="number">4</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample(values, <span class="number">3</span>)</span><br><span class="line">[<span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample(values, <span class="number">3</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>如果你仅仅只是想打乱序列中元素的顺序，可以使用 <code>random.shuffle()</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(values)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(values)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values</span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Recap-1"><a href="#Recap-1" class="headerlink" title="Recap"></a><font color=LightCoral>Recap</font></h3><ul>
<li><input checked="" disabled="" type="checkbox"> 给每个图片文件指定路径 <code>data = SOURCE + unitData</code></li>
<li><input checked="" disabled="" type="checkbox"> 如果图片文件大小大于零，就加入dataset   <code>os.path.getsize(path)</code></li>
<li><input checked="" disabled="" type="checkbox"> 计算出训练集和测试分别所占的图片数 <code>int(len(dataset)*SPLIT_SIZE)</code></li>
<li><input checked="" disabled="" type="checkbox"> 打乱数据集 <code>random.sample()</code>，这里可以用<code>random.shuffle</code>代替</li>
<li><input checked="" disabled="" type="checkbox"> 将数据集分别分给训练集和测试集 <code>[0:train_data_length]</code>，<code>[-test_data_length:]</code></li>
<li><input checked="" disabled="" type="checkbox"> 将图片从Source文件夹复制到Training和testing文件夹下</li>
</ul>
<h3 id="Plot-loss-And-Accuracy"><a href="#Plot-loss-And-Accuracy" class="headerlink" title=" Plot loss And Accuracy"></a><font color=LightSalmon> Plot loss And Accuracy</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.image  <span class="keyword">as</span> mpimg</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc=history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc=history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss=history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss=history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs=range(len(acc)) <span class="comment"># Get number of epochs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation accuracy per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;r&#x27;</span>, <span class="string">&quot;Training Accuracy&quot;</span>)			<span class="comment"># 横轴、纵轴、颜色、label</span></span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;b&#x27;</span>, <span class="string">&quot;Validation Accuracy&quot;</span>) 	<span class="comment"># 横轴、纵轴、颜色、label</span></span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation loss per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;r&#x27;</span>, <span class="string">&quot;Training Loss&quot;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;b&#x27;</span>, <span class="string">&quot;Validation Loss&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Desired output. Charts with training and validation metrics. No crash :)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>是<code>acc</code>还是<code>accuracy</code>，取决于<code>model.compile(optimizer=RMSprop(lr=0.001), loss=&#39;binary_crossentropy&#39;, metrics=[&#39;acc&#39;])</code> 的这个<code>metrics</code>是<code>acc</code>还是<code>accuracy</code></p>
</li>
<li><p>色彩：支持的颜色缩写是单个字母代码</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>颜色</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#39;b&#39;</code></td>
<td>蓝色</td>
</tr>
<tr>
<td><code>&#39;g&#39;</code></td>
<td>绿色</td>
</tr>
<tr>
<td><code>&#39;r&#39;</code></td>
<td>红</td>
</tr>
<tr>
<td><code>&#39;c&#39;</code></td>
<td>青色</td>
</tr>
<tr>
<td><code>&#39;m&#39;</code></td>
<td>品红</td>
</tr>
<tr>
<td><code>&#39;y&#39;</code></td>
<td>黄色</td>
</tr>
<tr>
<td><code>&#39;k&#39;</code></td>
<td>黑色</td>
</tr>
<tr>
<td><code>&#39;w&#39;</code></td>
<td>白色</td>
</tr>
</tbody></table>
<p>或者这样也可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">epochs=range(len(acc))</span><br><span class="line">plt.plot(epochs,acc)</span><br><span class="line">plt.plot(epochs,val_acc)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs,loss )</span><br><span class="line">plt.plot(epochs,val_loss)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.figure()</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="Week2-Exercise4"><a href="#Week2-Exercise4" class="headerlink" title="Week2 Exercise4"></a>Week2 Exercise4</h2><h3 id="Get-Data"><a href="#Get-Data" class="headerlink" title="Get Data"></a><font color=LightSalmon>Get Data</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">filename</span>):</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">You will need to write code that will read the file passed into this function. The first line contains the column headers so you should ignore it. Each successive line contians 785 comma separated values between 0 and 255. The first value is the label.The rest are the pixel values for that picture.The function will return 2 np.array types. One with all the labels.One with all the images. Tips: If you read a full line (as &#x27;row&#x27;) then row[0] has the label,and row[1:785] has the 784 pixel values. Take a look at np.array_split to turn the 784 pixels into 28x28. You are reading in strings, but need the values to be floats.Check out np.array().astype for a conversion</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>    </span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> training_file:</span><br><span class="line">    <span class="comment"># Your code starts here</span></span><br><span class="line">        csv_reader = csv.reader(training_file, delimiter=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        first_line = <span class="literal">True</span></span><br><span class="line">        temp_labels= []</span><br><span class="line">        temp_images = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:</span><br><span class="line">        <span class="comment"># Makes first iteration of loop for first row do nothing.</span></span><br><span class="line">        <span class="comment"># That&#x27;s how you skip the first row with headers.</span></span><br><span class="line">            <span class="keyword">if</span> first_line: </span><br><span class="line">                first_line = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp_labels.append(row[<span class="number">0</span>])</span><br><span class="line">                image_data = row[<span class="number">1</span>:<span class="number">785</span>] </span><br><span class="line">                image_array = np.array_split(image_data, <span class="number">28</span>) <span class="comment"># Make 28 x 28</span></span><br><span class="line">                temp_images.append(image_array)</span><br><span class="line">        </span><br><span class="line">        images = np.array(temp_images).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">        labels = np.array(temp_labels).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">      <span class="comment"># Your code ends here</span></span><br><span class="line">    <span class="keyword">return</span> images, labels</span><br><span class="line"></span><br><span class="line">path_sign_mnist_train = <span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/sign_mnist_train.csv&quot;</span></span><br><span class="line">path_sign_mnist_test = <span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/sign_mnist_test.csv&quot;</span></span><br><span class="line">training_images, training_labels = get_data(path_sign_mnist_train)</span><br><span class="line">testing_images, testing_labels = get_data(path_sign_mnist_test)</span><br><span class="line"></span><br><span class="line">print(training_images.shape)</span><br><span class="line">print(training_labels.shape)</span><br><span class="line">print(testing_images.shape)</span><br><span class="line">print(testing_labels.shape)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>with open() as</code>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/MsSpark/article/details/86745391?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522159737196419195162501901%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=159737196419195162501901&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v3~pc_rank_v3-1-86745391.pc_ecpm_v3_pc_rank_v3&utm_term=with+open+as+f%E7%94%A8%E6%B3%95&spm=1018.2118.3001.4187">详情</a></p>
</li>
<li><p><code>csv_reader = csv.reader</code>：读取csv文件</p>
<p><code>Dialect.delimiter</code>：一个用于分隔字段的单字符字符串。默认为<code>&#39;,&#39;</code>。</p>
</li>
<li><p><code>First_line</code>用于跳过第一行，也可以用<code>   next(csv_reader, None)  # skip the headers</code></p>
<p>第一行往往是标题，所以需要被跳过</p>
</li>
<li><p><code>numpy.array_split </code>：将数组拆分为大小相等的多个子数组</p>
</li>
<li><p><code>numpy.array(temp_array).astype()</code>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/A632189007/article/details/77989287">数据类型转换</a></p>
</li>
</ul>
<p>CSV的文件应该是：</p>
<table>
<thead>
<tr>
<th>标签（Label）</th>
<th>像素值1</th>
<th>像素值2</th>
<th>…</th>
<th>像素值785</th>
</tr>
</thead>
<tbody><tr>
<td><code>row[1][0]</code> 图片1</td>
<td><code>row[1][1]</code></td>
<td><code>row[1][2]</code></td>
<td>…</td>
<td><code>row[1][785]</code></td>
</tr>
<tr>
<td><code>row[2][0]</code> 图片2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>row[n][0]</code> 图片n</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="Recap-2"><a href="#Recap-2" class="headerlink" title="Recap"></a><font color=LightCoral>Recap</font></h3><ul>
<li><input checked="" disabled="" type="checkbox"> 打开csv文件 <code>csv.reader()</code></li>
<li><input checked="" disabled="" type="checkbox"> 读取csv文件每一行，记得跳过第一行</li>
<li><input checked="" disabled="" type="checkbox"> 每一行的加入到<code>temp_labels</code>的数据集中，剩下的全是<code>image_data</code>，再将<code>image_data</code>分成28份<code>image_array</code>，每一份都加入到<code>temp_images</code>的数据集中</li>
<li><input checked="" disabled="" type="checkbox"> 更改数据类型，<code>numpy.array(temp_array).astype()</code></li>
</ul>
<h3 id="Add-Dimensional"><a href="#Add-Dimensional" class="headerlink" title="Add Dimensional"></a><font color=LightSalmon>Add Dimensional</font></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In this section you will have to add another dimension to the data</span></span><br><span class="line"><span class="comment"># So, for example, if your array is (10000, 28, 28)</span></span><br><span class="line"><span class="comment"># You will need to make it (10000, 28, 28, 1)</span></span><br><span class="line"><span class="comment"># Hint: np.expand_dims</span></span><br><span class="line"></span><br><span class="line">training_images = np.expand_dims(training_images, axis=<span class="number">-1</span>)</span><br><span class="line">testing_images =  np.expand_dims(testing_images, axis=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>np.expand_dims</code>：增加一个维度。axis=1代表扩展行，axis=0代表扩展列,axis=-1代表扩展最后一个参数。<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31829611/article/details/89293113?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param">详情</a></p>
<p> 但是为啥要增加维度呢？我也不知道。啥时候解决了这个问题我再来填坑。</p>
</li>
</ul>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>程海盐</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://allmainashley.github.io/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Convolutional%20Neural%20Networks/" title="Tensorflow 卷积网络">https://allmainashley.github.io/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Convolutional%20Neural%20Networks/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Nature%20Language%20Processing/" rel="prev" title="Tensorflow Natural Language Processing"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Tensorflow Natural Language Processing</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/09/30/Notes/Machine%20Learning/Tensorflow%20Basic%20Programming/" rel="next" title="Tensorflow 基础编程"><span class="post-nav-text">Tensorflow 基础编程</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>若您无 GitHub 账号，可直接在下方匿名评论。</span><br><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/AllMainAshley/AllMainAshley.github.io/issues?q=is:issue+Tensorflow 卷积网络">GitHub Issues</a></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":"duRJqtj9W4MnlhHrkhx0O3vb-gzGzoHsz","appKey":"7GxBY57ustzpxvpwNr39XneW","placeholder":"I want to say...","avatar":null,"pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"el":"#valine-container","lang":"en"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 800)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 程海盐</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.2.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.3.0</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-05-10T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#A288C0" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>